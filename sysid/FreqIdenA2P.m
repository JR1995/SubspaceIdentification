function G = FreqIdenA2P(NumOfTest, na, nb)
%频域辨识
%   NumOfTest是实验数据编号，包含幅值、相位和频率点向量
%   na是系统极点数量
%   nb是系统零点数量


if(NumOfTest == 1)
%20151106一号机
mag = [3.00252	3.18015	3.10566	3.16296	3.205935	3.314805	3.8964	3.81618	2.54985	1.6617	2.04561	1.82214	0.96837];
phi = [1.9564	3.254	6.1412	8.5134	18.8233	36.0527	51.8091	138.9162	163.5533	168.3234	169.6744	202.899	227.3234];
FF = [0.5	1	2	3.8	11	22.4	30	49.5	69.5	82	90	100	120];
end

if(NumOfTest == 2)
%20151106二号机
mag = [0.024	0.0198	0.0194	0.0202	0.01665	0.0162	0.0168	0.0178	0.0226	0.02368	0.0201	0.0256	0.0382];
phi = [1.7773	3.0894	4.5805	5.7706	16.7908	28.9253	36.0656	43.664	73.3213	81.7919	155.7143	102.7797	92.2942];
FF = [0.5	1	2	3.8	11	22.4	30	49.5	69.5	82	90	100	120];
end

if(NumOfTest == 3)
%20151030二号机
mag = [1.210749	1.296699	1.19184	1.04859	0.915654	0.929979	1.03713	1.150584	1.500114	1.429635	1.257735	1.035984];
phi = [3.7749	5.6579	5.8201	16.7132	23.703	33.0238	46.4827	58.06	57.7331	130.7247	147.7878	172.1699];
FF = [1	2	3.8	11	22.4	30	49.5	69.5	82	90	100	120];
end

if(NumOfTest == 4)
% 20160531四号机短管，液阻无穷
mag = [0.0397	0.040166667		0.035275		0.0647	0.1126	0.077033333	0.1319	0.0959	0.031133333	0.006725];
phi = [-2.023666667	9.636266667		19.764525		50.672925	161.8212	229.8701333	294.8255	367.011	408.5979667	440.38365];
FF = [1	2 11 30	49.5	69.5	82	90	100	120];
end

if(NumOfTest == 5)
%20160531四号机短管，液阻有限
mag = [0.0454	0.047		0.042		0.0749	0.0958	0.0337	0.0233	0.0198	0.0177	0.0149];
phi = [5.217	7.235		18.534		55.046	175.715	230.303	251.674	264.499	278.717	312.7059];
FF = [1	2 11 30	49.5	69.5	82	90	100	120];
end

if(NumOfTest == 6)
%20150926角加
mag = [0.4 0.46 0.49 0.5 0.51 0.5 0.499 0.475 0.443 0.41 0.41 0.386 0.33];
phi = [-38.5 -20.8 -9.5 -1.8 11.5 26.8 36.5 60.5 84.5 96.8 107 118 138];
FF = [0.5	1	2	3.8	11	22.4	30	49.5	69.5	82	90	100	120];
end

if(NumOfTest == 7)
%20160721计量院
mag = [0.77125	0.805	0.815	0.82375	0.7425	0.71125	0.7375	0.80375	1.05125	1.195	2.10375	2.045	2.31125	3.0725	2.80625	2.73	2.1025	1.3825	0.6175	0.12875];
phi = [-19.51	-5.97	-3.06	-5.32	-13.01	-10.06	-11.28	-18.98	-42.43	-48.46	-65.69	-74.14	-78.35	-19.51	-284.39	-287.84	-315.33	-4.29	-30.86	-47.33];
FF = [1 2 4 8 12.5 16 20 31.5 63 70 80 90 91 92 95 100 110 120 130 160];
end

if(NumOfTest == 8)
%20160721计量院
mag = [5.19	5.79375	6.465	6.78375	6.80625	6.90875	7.19375	7.27125	7.75875	8.83	10.24	10.6575	13.0475	13.0125	11.5725	11.75125	9.08875	1.26875];
phi = [-19.56	-5.97	-2.81	-4.44	-5.48	-10.61	-14.32	-21.34	-27.22	-34.87	-40.55	-48.89	-77.6	-96.54	-287.85	-297.01	-330.42	-318.37];
FF = [1	2	4	8	10	16	20	30	40	50	55	60	70	75	78	80	90	150];
end

mag = mag';
phi = -phi';
FF = FF';

%   频响向量
hp = mag .* (cosd(phi) + 1i * sind(phi));  
%   频率点单位转换为 rad/s
w = 2 * pi * FF;  

%   计算传递函数参数
[bb, aa] = invfreqs(hp, w, nb, na); 
G = tf(bb, aa);

%   得到辨识系统的频率响应向量
hf = freqs(bb, aa, w);              
%   计算幅频特性和相频特性
sysmag = abs(hf);                
sysmag1 = 20 * log10(sysmag);    % 单位转换为dB
sysph = angle(hf);               % 单位为弧度
sysph1 = sysph * 180 / pi;       % 单位为度

%   绘制Bode图
figure(1);
subplot(2,1,1); 
semilogx(FF,mag,'r*-','LineWidth',1.5);hold on;
semilogx(FF,sysmag,'b','LineWidth',1.5);grid on;
xlabel('Hz');ylabel('K');
legend('真实系统','辨识系统');
subplot(2,1,2);
semilogx(FF,phi,'r*-','LineWidth',1.5);hold on;
semilogx(FF,sysph1,'b','LineWidth',1.5);grid on;
xlabel('Hz');ylabel('Phase(Deg.)');
legend('真实系统','辨识系统');